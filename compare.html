<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π Audi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #111;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            padding: 80px 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 40px;
        }
        .slot-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .car-slot {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            width: 280px;
            min-height: 400px;
            text-align: center;
        }
        .car-slot img {
            max-width: 100%;
            max-height: 150px;
            object-fit: contain;
            margin-bottom: 15px;
        }
        select {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            background: #333;
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .view-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .compare-table {
            width: 100%;
            margin-top: 50px;
            border-collapse: collapse;
        }
        .compare-table th, .compare-table td {
            border: 1px solid #444;
            padding: 10px;
            text-align: center;
        }
        .compare-table th {
            background: #222;
        }
        canvas {
            margin-top: 40px;
            max-width: 100%;
        }
    </style>
</head>
<body>

<h1>–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π Audi</h1>
<div class="slot-container" id="slots"></div>

<div id="comparisonArea">
    <table id="comparisonTable" class="compare-table" style="display:none;"></table>
    <canvas id="chartCanvas" style="display:none;"></canvas>
</div>

<script>
    let allCars = [];
    let selectedCars = [null, null, null];

    function generateSpecs(car) {
        const id = (car.id || "").toLowerCase();

        if (!car.engine) {
            if (id.includes("r8")) car.engine = "5.2L V10 FSI";
            else if (id.includes("rs")) car.engine = "4.0L V8 Biturbo";
            else if (id.includes("sq")) car.engine = "3.0L V6 Turbo Quattro";
            else if (id.includes("q")) car.engine = "2.0L TFSI Quattro";
            else if (id.includes("a8l")) car.engine = "3.0L V6 Mild Hybrid";
            else if (id.includes("a8")) car.engine = "3.0L V6 TFSI";
            else if (id.includes("a")) car.engine = "2.0L TFSI";
            else car.engine = "1.8L TFSI";
        }

        if (!car.transmission) car.transmission = "Automatic";

        if (!car.acceleration) {
            if (id.includes("r8")) car.acceleration = (Math.random() * 0.7 + 3.1).toFixed(1);
            else if (id.includes("rs")) car.acceleration = (Math.random() * 0.7 + 3.5).toFixed(1);
            else if (id.includes("sq")) car.acceleration = (Math.random() * 0.6 + 4.8).toFixed(1);
            else if (id.includes("a8l")) car.acceleration = (Math.random() * 0.5 + 4.5).toFixed(1);
            else if (id.includes("q")) car.acceleration = (Math.random() * 1.5 + 6.0).toFixed(1);
            else if (id.includes("a")) car.acceleration = (Math.random() * 1.5 + 5.0).toFixed(1);
            else car.acceleration = (Math.random() * 1.0 + 6.5).toFixed(1);
        }

        if (!car.topSpeed) {
            if (id.includes("r8")) car.topSpeed = Math.floor(Math.random() * 20 + 310);
            else if (id.includes("rs")) car.topSpeed = Math.floor(Math.random() * 25 + 280);
            else if (id.includes("sq")) car.topSpeed = Math.floor(Math.random() * 20 + 260);
            else if (id.includes("q")) car.topSpeed = Math.floor(Math.random() * 30 + 210);
            else if (id.includes("a8l")) car.topSpeed = Math.floor(Math.random() * 20 + 250);
            else if (id.includes("a")) car.topSpeed = Math.floor(Math.random() * 20 + 240);
            else car.topSpeed = Math.floor(Math.random() * 20 + 210);
        }

        return car;
    }

    async function fetchCars() {
        try {
            const res = await fetch("/api/cars");
            const raw = await res.json();
            allCars = raw.map(generateSpecs);
            renderSlots();
            renderComparison();
        } catch (e) {
            console.error("‚ùå Error fetching cars:", e);
        }
    }

    function renderSlots() {
        const container = document.getElementById("slots");
        container.innerHTML = "";

        for (let i = 0; i < 3; i++) {
            const slot = document.createElement("div");
            slot.className = "car-slot";

            const select = document.createElement("select");
            select.innerHTML = `<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –º–æ–¥–µ–ª—å</option>` +
                allCars.map(car => `<option value="${car.id}">${car.name}</option>`).join("");

            select.value = selectedCars[i]?.id || "";
            select.addEventListener("change", (e) => {
                const id = e.target.value;
                selectedCars[i] = allCars.find(c => c.id === id) || null;
                renderSlots(); // üîÅ –æ–Ω–æ–≤–∏—Ç–∏ –ø—ñ—Å–ª—è –≤–∏–±–æ—Ä—É
                renderComparison();
            });

            slot.appendChild(select);

            if (selectedCars[i]) {
                const car = selectedCars[i];
                slot.appendChild(document.createElement("br"));

                const img = document.createElement("img");
                img.src = car.image;
                img.alt = car.name;
                slot.appendChild(img);

                const title = document.createElement("h3");
                title.textContent = car.name;
                slot.appendChild(title);

                const price = document.createElement("p");
                price.textContent = car.price + " ‚Ç¨";
                slot.appendChild(price);

                const btn = document.createElement("button");
                btn.className = "view-btn";
                btn.textContent = "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏";
                btn.onclick = () => window.location.href = `models/${car.page || car.id}.html`;
                slot.appendChild(btn);
            } else {
                const empty = document.createElement("p");
                empty.textContent = `–°–ª–æ—Ç ${i + 1}`;
                empty.style.opacity = 0.4;
                empty.style.marginTop = "50px";
                slot.appendChild(empty);
            }

            container.appendChild(slot);
        }
    }

    function renderComparison() {
        const table = document.getElementById("comparisonTable");
        const canvas = document.getElementById("chartCanvas");
        const cars = selectedCars.filter(Boolean);
        if (cars.length === 0) {
            table.style.display = canvas.style.display = "none";
            return;
        }

        table.style.display = "table";
        canvas.style.display = "block";
        table.innerHTML = "";

        const rows = [
            ["–ù–∞–∑–≤–∞", ...cars.map(c => c.name)],
            ["–¶—ñ–Ω–∞", ...cars.map(c => c.price + " ‚Ç¨")],
            ["–î–≤–∏–≥—É–Ω", ...cars.map(c => c.engine)],
            ["–ö–æ—Ä–æ–±–∫–∞", ...cars.map(c => c.transmission)],
            ["–†–æ–∑–≥—ñ–Ω 0-100", ...cars.map(c => c.acceleration + " —Å–µ–∫")],
            ["–ú–∞–∫—Å. —à–≤–∏–¥–∫—ñ—Å—Ç—å", ...cars.map(c => c.topSpeed + " –∫–º/–≥")]
        ];

        for (const row of rows) {
            const tr = document.createElement("tr");
            tr.innerHTML = `<th>${row[0]}</th>` + row.slice(1).map(val => `<td>${val}</td>`).join("");
            table.appendChild(tr);
        }

        drawChart(cars);
    }

    function drawChart(cars) {
        const ctx = document.getElementById("chartCanvas").getContext("2d");
        if (window.chart) window.chart.destroy();
        window.chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: cars.map(c => c.name),
                datasets: [
                    {
                        label: '–ú–∞–∫—Å. —à–≤–∏–¥–∫—ñ—Å—Ç—å (–∫–º/–≥)',
                        data: cars.map(c => parseInt(c.topSpeed)),
                        backgroundColor: 'rgba(255, 99, 132, 0.7)'
                    },
                    {
                        label: '–†–æ–∑–≥—ñ–Ω 0-100 (—Å–µ–∫)',
                        data: cars.map(c => parseFloat(c.acceleration)),
                        backgroundColor: 'rgba(54, 162, 235, 0.7)'
                    }
                ]
            },
            options: {
                plugins: {
                    legend: { labels: { color: "#fff" } }
                },
                scales: {
                    x: { ticks: { color: "#fff" } },
                    y: { ticks: { color: "#fff" }, beginAtZero: true }
                }
            }
        });
    }

    window.addEventListener("DOMContentLoaded", fetchCars);
</script>
</body>
</html>
