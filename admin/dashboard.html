<!DOCTYPE html>
<html lang="uk">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="UTF-8">
  <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>

<div id="loader" class="loader-wrapper">
  <div class="loader-content">
    <img src="media/audi-logo-white.png" alt="Audi Logo">
    <div class="loader-ring"></div>
  </div>
</div>

<div class="topbar">
  <span>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</span>
  <div class="topbar-links">
    <a href="../index.html">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ —Å–∞–π—Ç</a>
    <a href="#" id="logoutBtn">–í–∏–π—Ç–∏ –∑ –∞–∫–∫–∞—É–Ω—Ç—É</a>
  </div>
</div>

<div class="dashboard-wrapper">
  <div class="dashboard-form">
    <h2>–î–æ–¥–∞—Ç–∏ –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –∞–≤—Ç–æ</h2>
    <form id="carForm">
      <select id="carName" required>
        <option value="">–û–±–µ—Ä—ñ—Ç—å –º–æ–¥–µ–ª—å</option>
        <option value="a5.html">Audi A5</option>
        <option value="a6.html">Audi A6</option>
        <option value="a7.html">Audi A7</option>
        <option value="a7l.html">Audi A7L</option>
        <option value="a8.html">Audi A8</option>
        <option value="a8l.html">Audi A8L</option>
        <option value="q5.html">Audi Q5</option>
        <option value="q7.html">Audi Q7</option>
        <option value="q8.html">Audi Q8</option>
        <option value="q8rs.html">Audi Q8 RS</option>
        <option value="r8.html">Audi R8</option>
        <option value="rs6.html">Audi RS6</option>
        <option value="rs7.html">Audi RS7</option>
        <option value="sq7.html">Audi SQ7</option>
      </select>

      <input type="text" id="carImage" placeholder="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è (URL)" required>
      <input type="text" id="carPrice" placeholder="–¶—ñ–Ω–∞ (‚Ç¨)" required>
      <input type="hidden" id="editIndex">
      <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </form>

    <h3>–ö–∞—Ç–∞–ª–æ–≥</h3>
    <div id="carList" class="car-list"></div>
  </div>
</div>

<script>
  if (localStorage.getItem("isAdmin") !== "true") {
    window.location.href = "index.html";
  }

  const carForm = document.getElementById("carForm");
  const carList = document.getElementById("carList");
  const editIndex = document.getElementById("editIndex");

  async function loadCars() {
    const res = await fetch("/api/cars");
    const cars = await res.json();

    carList.innerHTML = "";
    if (cars.length === 0) {
      carList.innerHTML = "<p>–ö–∞—Ç–∞–ª–æ–≥ –ø–æ—Ä–æ–∂–Ω—ñ–π.</p>";
      return;
    }

    cars.forEach((car, index) => {
      const div = document.createElement("div");
      div.className = "car-list-item";
      div.innerHTML = `
        <strong>${car.name}</strong> ‚Äî ${car.price} ‚Ç¨<br>
        <img src="${car.image}" width="120"><br>
        üîã ${car.power || '-'} | üîÅ ${car.drive || '-'} | ‚õΩ ${car.fuel || '-'} | üìÖ ${car.year || '-'}<br>
        <button onclick="editCar(${index})">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
        <button onclick="deleteCar(${index})">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
      `;
      carList.appendChild(div);
    });
  }

  async function editCar(index) {
    const res = await fetch("/api/cars");
    const cars = await res.json();
    const car = cars[index];

    const select = document.getElementById("carName");
    for (let i = 0; i < select.options.length; i++) {
      if (select.options[i].value === car.page) {
        select.selectedIndex = i;
        break;
      }
    }

    document.getElementById("carImage").value = car.image;
    document.getElementById("carPrice").value = car.price;
    editIndex.value = index;
  }

  async function deleteCar(index) {
    await fetch(`/api/cars/${index}`, { method: "DELETE" });
    loadCars();
  }

  carForm.addEventListener("submit", async function (e) {
    e.preventDefault();

    const nameSelect = document.getElementById("carName");
    const car = {
      name: nameSelect.options[nameSelect.selectedIndex].text,
      page: nameSelect.value,
      image: document.getElementById("carImage").value.trim(),
      price: document.getElementById("carPrice").value.trim()
    };

    if (editIndex.value !== "") {
      await fetch(`/api/cars/${editIndex.value}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(car)
      });
      editIndex.value = "";
    } else {
      await fetch("/api/cars", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(car)
      });
    }

    carForm.reset();
    loadCars();
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("isAdmin");
    window.location.href = "index.html";
  });

  loadCars();
</script>
</body>
</html>
